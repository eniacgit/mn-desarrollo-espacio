
<form role="form" name="form" class="form-horizontal" >

	<div class="row">
		<div class="col-xs-3">
			<div class="control-group">
			    <label class="control-label">Cotizaci贸n</label>
			    <div class="controls">
			      <input type="text" 
			             cam-variable-name="cotizacion"
			             readonly="true" 
			             class="form-control" />      
			    </div>
		  	</div>
	  	</div>
	  	
	  	<div class="col-xs-3">
		  <div class="control-group">
			    <label class="control-label">Cliente</label>
			    <div class="controls">
			      <input type="text" 
			             cam-variable-name="cliente"
			             readonly="true" 
			             class="form-control" />      
			    </div>
		  	</div>
	  	</div>
	  	
	  	<div class="col-xs-3">
			  <div class="control-group">
				    <label class="control-label">Valor presupuestado (USD)</label>
				    <div class="controls">
				      <input type="text" 
				             cam-variable-name="valorPresupuesto"
				             ng-model="valorPresupuesto"
				             readonly="true" 
				             class="form-control" />      
				    </div>
			  	</div>
	  	</div>  
	  	
	  	<div class="col-xs-3">
			  <div class="control-group">
				    <label class="control-label">Valor/Hora (USD)</label>
				    <div class="controls">
				      <input type="text" 
				             cam-variable-name="valorHora"
				             ng-model="ngValorHora"				             
				             readonly="true" 
				             class="form-control" />
				    </div>
			  	</div>
	  	</div>  
	  	
	    
	</div>
	
	<hr>
	<br>
	<h4>
		<strong>
			Cierre de propuesta.
		</strong>	  
	</h4>	
	
	<div class="row">
		<div class="col-xs-4">
			<div class="control-group">
			 	<label class="control-label">Fecha de inicio</label>
				<p class="input-group">		
				<input id="proyCerrFechInicio"
					   type="text"
				       cam-variable-name="proyCerrFechInicio"
				       cam-variable-type="Date"
				       ng-model="dataCronoCierrePropuesta.proyCerrFechInicio"
				       class="form-control"
				       datepicker-popup="yyyy-MM-dd'T'HH:mm:ss"  
				       is-open="dateFieldOpened" 
				       required />
				
				  <span class="input-group-btn">
				    <button type="button"
				            class="btn btn-default"
				            ng-click="open($event)">
				      <i class="glyphicon glyphicon-calendar"></i>
				    </button>
				  </span>
				</p>
			</div>	
		</div>	
		
		<div class="col-xs-4">
			<div class="control-group">
			 	<label class="control-label">Fecha de FIN</label>
				<p class="input-group">		
				<input id="proyCerrFechFin"
					   type="text"
				       cam-variable-name="proyCerrFechFin"
				       ng-model="dataCronoCierrePropuesta.proyCerrFechFin"
				       cam-variable-type="Date"
				       class="form-control"
				       datepicker-popup="yyyy-MM-dd'T'HH:mm:ss"
				       is-open="dateFieldOpened2" 
				       required />
				
				  <span class="input-group-btn">
				    <button type="button"
				            class="btn btn-default"
				            ng-click="open2($event)">
				      <i class="glyphicon glyphicon-calendar"></i>
				    </button>
				  </span>
				</p>
			</div>	
		</div>
		
		<div class="col-xs-4">
			  <div class="control-group">
				    <label class="control-label">Horas totales</label>
				    <div class="controls">
				      <input id="proyCerrHoras"
				      	     type="number" 
				             ng-model="dataCronoCierrePropuesta.proyCerrHoras"
				             class="form-control"
				             name="PROYCERRHORAS" 
				             required 
				             min="0" />      
				             
				      <!--validar horas totales-->
		      		  <p>
		      			 <span style="color:red" ng-show="form.PROYCERRHORAS.$dirty && form.PROYCERRHORAS.$invalid">
		  				 <span ng-show="form.PROYCERRHORAS.$error.required">horas totales obligatorio</span>
		  				 </span>
		      	      </p>
				    </div>
			  	</div>
	  	</div>			
	</div>
	
			
	<hr>
	<br>
	<h3>
		<strong>
			Resumen de la etapa de cierre de propuesta
		</strong>	  
	</h3>	
	
	<div class="row">
		<div class="col-xs-6">
			  
			<div class="control-group">
	  			<div class="controls">	  		
	  			<h4>Total de horas: {{dataCronoCierrePropuesta.proyCerrHoras}}</h4>
	  			<h4>Costo total: {{(dataCronoCierrePropuesta.proyCerrHoras) * (ngValorHora) | number}}</h4>
	  		</div>
	  	</div>	  
	</div>		
</div>

<hr>
<br>
<p class="text-center"> <Strong>Detalle costo/hora del proceso desarrollo espacio.</Strong> </p>
<table class="table table-bordered">
  <thead class="thead-dark">
    <tr class="bg-primary">
      <th scope="col">Etapas del proceso desarrollo espacio</th>
      <th scope="col">Horas (Hs)</th>
      <th scope="col">Costo (USD)</th>
    </tr>
  </thead>
  <tbody>
    <tr class="bg-secondary">
      <th scope="row">Investigaci贸n y desarrollo</th>
      <td>{{calcularHorasInvesYdes()}}</td>
      <td>{{calcularHorasInvesYdes() * (ngValorHora) | number}}</td>      
    </tr>
    <tr class="bg-secondary">
      <th scope="row">Presupuestaci贸n</th>
      <td>{{calcularHorasPresupuestacion()}}</td>
      <td>{{calcularHorasPresupuestacion() * (ngValorHora) | number}}</td>
    </tr>
    <tr class="bg-secondary">
      <th scope="row">Cierre de propuesta</th>
      <td>{{dataCronoCierrePropuesta.proyCerrHoras}}</td>
      <td>{{dataCronoCierrePropuesta.proyCerrHoras * (ngValorHora) | number}}</td>
    </tr>
    <tr class="bg-danger">
      <th scope="row"><strong>Total</strong></th>
      <td>{{ calcularHorasInvesYdes() + calcularHorasPresupuestacion() + dataCronoCierrePropuesta.proyCerrHoras}}</td>
      <td>{{(calcularHorasInvesYdes() + calcularHorasPresupuestacion() + dataCronoCierrePropuesta.proyCerrHoras) * (ngValorHora) | number}}</td>
    </tr>
  </tbody>
</table>

<br>
<br>
<h4>Ganancia (USD): {{calcularGananciaTotal()}}</h4>
	
  <script cam-script type="text/form-script">


camForm.on('form-loaded', function() {
  // tell the form SDK to fetch the json variable named 'customer'
  camForm.variableManager.fetchVariable('jsonCronInvesIdes');
});

camForm.on('variables-fetched', function() {
  // work with the variable (bind it to the current AngularJS $scope)
  $scope.jsonCronInvesIdes = camForm.variableManager.variableValue('jsonCronInvesIdes');
});


camForm.on('form-loaded', function() {
  // tell the form SDK to fetch the json variable named 'jsonCronoPresupuestacion'
  camForm.variableManager.fetchVariable('jsonCronoPresupuestacion');
});

camForm.on('variables-fetched', function() {
  // work with the variable (bind it to the current AngularJS $scope)
  $scope.jsonCronoPresupuestacion = camForm.variableManager.variableValue('jsonCronoPresupuestacion');
});


	
	var dataCronoCierrePropuesta = $scope.dataCronoCierrePropuesta={};
	
	camForm.on('form-loaded', function() {

    // declare variable 'customerData' incuding metadata for serialization
    camForm.variableManager.createVariable({
      name: 'dataCronoCierrePropuesta',
      type: 'Object',
      value: dataCronoCierrePropuesta,
      valueInfo: {
        // indicate that object is serialized as json
        serializationDataFormat: 'application/json',
        // provide classname of java object to map to
        objectTypeName: 'org.camunda.bpm.menini_nicola.mn_desarrollo_espacio.modelo.CronoCierrePropuesta'
						 
      }
    });

  });
  	$scope.open = function($event) {
    	$event.preventDefault();
    	$event.stopPropagation();

    	$scope.dateFieldOpened = true;
  	};

	$scope.open2 = function($event) {
    	$event.preventDefault();
    	$event.stopPropagation();

    	$scope.dateFieldOpened2 = true;
  	};

	// Funcion para calcular total de horas de investigaci贸n y desarrollo
	$scope.calcularHorasInvesYdes = function(){
	
		var anMarcaHoras = $scope.jsonCronInvesIdes.anMarcaHoras;
		var desConcepHoras = $scope.jsonCronInvesIdes.desConcepHoras;
		var desPropHoras = $scope.jsonCronInvesIdes.desPropHoras;
		var ajInterHoras = $scope.jsonCronInvesIdes.ajInterHoras;

 		return anMarcaHoras + desConcepHoras + desPropHoras + ajInterHoras; 
	}	

	// Funcion para calcular total de horas de presupuestacion
	$scope.calcularHorasPresupuestacion = function(){
 
		var scoutProdHoras = $scope.jsonCronoPresupuestacion.scoutProdHoras;
		var selecProvHoras = $scope.jsonCronoPresupuestacion.selecProvHoras;

		return scoutProdHoras + selecProvHoras;
	}

	// Funcion para calcular la ganancia total
	$scope.calcularGananciaTotal = function(){
	
		var totHorasInvesYdes = $scope.calcularHorasInvesYdes();
		var totHorasPresup = $scope.calcularHorasPresupuestacion();
		var totHorasCierreProp = $scope.dataCronoCierrePropuesta.proyCerrHoras;
		var valorHora = $scope.ngValorHora;

		var costoPresupuesto = $scope.valorPresupuesto;
		
		return parseInt(costoPresupuesto) - (totHorasInvesYdes + totHorasPresup + totHorasCierreProp) * parseInt(valorHora);  
		
	}
	
  </script>
</form>